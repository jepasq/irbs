#!/usr/bin/env ruby

VERSION="0.0.0"
REVISION="4"

# Argument handling
require_relative 'argument'
require_relative 'server'

srv = Server.new

arg=Argument.new


ni = ArgumentOption.new('--non-interactive',
                          'Print endpoint to console and exit.') do
  puts "NI option triggered"
  srv.interactive = false
end
ni.add_alias "-n"
arg.add ni

ep = ArgumentOption.new('--endpoint',
                          'The endpoint to print in non-interactive mode.') do
  srv.endpoint = ARGV[ARGV.index('--endpoint') + 1]
  exit(0)
end
ep.add_alias "-e"
arg.add ep

po = ArgumentOption.new('--port',
                          'The port to listen client from.') do
  srv.port = ARGV[ARGV.index('--port') + 1]
  exit(0)
end
po.add_alias "-p"
arg.add po

arg.add_usage
arg.consume(ARGV)

# Content/input directory
dirs = arg.only_dirs(ARGV)
dir = dirs[0]
if dir.nil?
  dir = Dir.pwd
else
  dir = File.expand_path(dir)
end

unless File.directory? dir
  raise "Directory passed as first argument (#{dir}) doesn't exist"
end  

srv.run dir
